server {
	listen 80;
	server_name {{ app_server_name }};
	resolver {{ podman_net_resolver }} valid=1s ipv6=off; 
	access_by_lua '
	  local opts = {
	    redirect_uri_path = "/redirect_uri",
	    accept_none_alg = true,
	    discovery = "http://keycloak:8080/realms/app-realm/.well-known/openid-configuration",
	    client_id = "app-client-0",
	    client_secret = "woosecretwoo",
	    redirect_uri_scheme = "http",
	    logout_path = "/logout",
	    redirect_after_logout_with_id_token_hint = false,
	    session_contents = {id_token=true}
	  }
	  -- call introspect for OAuth 2.0 Bearer Access Token validation
	  local res, err = require("resty.openidc").authenticate(opts)
	  if err then
	    ngx.status = 403
	    ngx.say(err)
	    ngx.exit(ngx.HTTP_FORBIDDEN)
	  end
	';
	 
	# I disabled caching so the browser won't cache the site.
	expires           0;
	add_header        Cache-Control private;    

	location / {
	    root     /usr/local/openresty/nginx/html/public;
	}
}
